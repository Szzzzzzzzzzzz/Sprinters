var ToolsetDynamicSources=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t){e.exports=lodash},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=window.wp.hooks},function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.data},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.wp.compose},function(e,t){e.exports=window.toolsetCommonEs.block.control},function(e,t){e.exports=window.wp.apiFetch},function(e,t){e.exports=window.wp.url},function(e,t,r){},function(e,t,r){},function(e,t,r){(function(e){var t,r,n;(n=function(e,t){return null==e||null==t?"":(e=n.dateToObject(e),t.replace(n.regexp,(function(t){return n.fn[t]?n.fn[t].call(e,n):t.replace("\\","")})))}).fn=function(){var e={d:"format.leading_zero(this.date)",D:"this.dayName.substr()",l:"this.dayName",S:"format.ordinalSuffix(this.date)",w:"this.day",j:"this.date",z:"this.dayOfYear",W:"this.weekNum",w:"this.day",j:"this.date",z:"this.dayOfYear",W:"this.weekNum",M:"format.months[this.month - 1].substr(0, 3)",F:"format.months[this.month - 1]",Y:"this.year",a:"this.am",A:"this.am.toUpperCase()",y:'("" + this.year).substr(2, 2)',c:"this.iso",m:"format.leading_zero(this.month)",U:"Math.round(this / 1000)",g:"this.hours12",G:"format.leading_zero(hours12)",h:"this.hours",H:"format.leading_zero(this.hours)",i:"format.leading_zero(this.min)",s:"format.leading_zero(this.sec)"};for(var t in e)e.hasOwnProperty(t)&&(e[t]=new Function("format","return "+e[t]));return e}(),n.regexp=(t=n.fn,r=[],Object.keys(t).forEach((function(e){r.push("(\\\\)?"+e)})),new RegExp(r.join("|"),"g")),n.dateToObject=function(e){var t=new Date(e.getFullYear(),0,1),r={date:e.getDate(),year:e.getFullYear(),hours:e.getHours(),day:e.getDay(),min:e.getMinutes(),sec:e.getSeconds(),month:e.getMonth()+1,iso:e.toISOString()};return r.dayName=n.days[r.day],r.am=r.hours<12?"am":"pm",r.hours12=r.hours%12,r.hours12=r.hours12>0?r.hours12:12,r.dayOfYear=Math.round((e-t)/864e5),r.weekNum=Math.ceil(((e-t)/864e5+t.getDay()-1)/7),r},n.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n.months=["January","February","March","April","May","June","Jule","August","September","October","November","December"],n.ordinalSuffix=function(e){return["th","st","nd","rd"][(e=~~(e<0?-e:e)%100)>10&&e<14||(e%=10)>3?0:e]},n.extendPrototype=function(){return Date.prototype.format=function(e){return n(this,e)},this},n.leading_zero=function(e){return(e="00"+e).substr(e.length-2)},function(t,r){if(t.noConflict=function(){return t},"undefined"!=typeof window){if(t.noConflict=function(){return delete window[r],t},window[r]){var n=window[r];t.noConflict=function(){return window[r]=n,delete window[r],t}}window[r]=t}else e&&(e.exports=t)}(n,"date_format")}).call(this,r(13)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){"use strict";r.r(t);var n=r(4),o=r(2),i=r(1),c=r(8),a=r.n(c),s=r(0),u=function(e){return e.match(/^custom_post_type\|[^\|]+\|\d+$/)||"__custom_post"===e||e.startsWith("toolset_relationship")};function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function p(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function f(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){p(i,n,o,c,a,"next",e)}function a(e){p(i,n,o,c,a,"throw",e)}c(void 0)}))}}var d=window.toolsetDynamicSourcesScriptData,b=function(e,t,r,n){var o=d.cacheForViews&&d.cacheForViews[t]?d.cacheForViews[t]:d.cache,i="";return void 0!==o[r]&&(i=o[r]),void 0===o[e]||void 0===o[e][r]||t!==o[e]["post-id"]&&!u(e)||(i=o[e][r]),void 0!==i[n]&&(i=i[n]),""!==i?{sourceContent:i}:null},y=function(){var e=f(regeneratorRuntime.mark((function e(t,r,o){var c,s,u,l,p,f,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=d.length>3&&void 0!==d[3]?d[3]:null,s=d.length>4&&void 0!==d[4]?d[4]:null,t&&r&&o){e.next=4;break}return e.abrupt("return",null);case 4:if(!(u=b(t,r,o,c))){e.next=7;break}return e.abrupt("return",u);case 7:return l="/toolset-dynamic-sources/v1/render-source/?source=".concat(o,"&provider=").concat(t,"&post=").concat(r),p="",c&&(p+="&field=".concat(c)),s&&(p+="&view-id=".concat(s)),""!==p&&(l+=p),e.prev=12,e.next=15,a()({path:l});case 15:return e.abrupt("return",e.sent);case 18:return e.prev=18,e.t0=e.catch(12),f=Object(i.sprintf)(Object(i.__)('Something went wrong while fetching the dynamic content from the selected source, with message: "%s".',"wpv-views"),e.t0.message),Object(n.dispatch)("core/notices").createErrorNotice(f,{id:"toolset_blocks_dynamic_source_content_preloading_error"}),e.abrupt("return",null);case 23:case"end":return e.stop()}}),e,null,[[12,18]])})));return function(t,r,n){return e.apply(this,arguments)}}(),m=function(){var e=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a()({path:"/toolset-dynamic-sources/v1/get-cache?post=".concat(t)});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),v=function(e){return new Promise((function(t){a()({path:"/toolset-dynamic-sources/v1/search-post?s=".concat(e)}).then((function(e){var r=e.map((function(e){return{label:e.title,value:"custom_post_type|".concat(e.post_type,"|").concat(e.id)}}));t(r)}))}))},h=function(){var e=f(regeneratorRuntime.mark((function e(t){var r,n,i,c,u,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.value.split("|"),n=l(r,3),i=n[1],c=n[2],e.next=3,a()({path:"toolset-dynamic-sources/v1/get-source?post_type=".concat(i,"&post_id=").concat(c)});case 3:u=e.sent,p=t.value,d.postProviders.find((function(e){return e.value===p}))||d.postProviders.push({value:p,label:t.label}),Object(o.doAction)("tb.dynamicSources.actions.providers.customPostLoaded",p,t.label),d.dynamicSources[p]=u.__current_post,Object(o.doAction)("tb.dynamicSources.actions.source.customPostLoaded",p,u),m(c).then((function(e){d.cache[p]=e.__current_post,Object(o.doAction)("tb.dynamicSources.actions.cache.customPostLoaded",p,e),Object(o.doAction)("tb.caching.updated")})),Object(o.addAction)("tb.caching.tick","toolset-blocks",function(){var e=f(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(c);case 2:r=e.sent,t[p]&&Object(s.isEqual)(t[p],r.__current_post)||(d.cache[p]=r.__current_post,Object(o.doAction)("tb.caching.updated"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function O(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}var g=window.toolsetDynamicSourcesScriptData,w=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var r,i,c,a,s,u,l,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Object(n.select)("core/editor"),i=Object(n.select)("core/block-editor"),c=JSON.stringify(i.getBlocks()),a=!!c.includes("dynamic"),s=!!c.includes("toolset-blocks/field"),u=!!c.includes("toolset-blocks/repeating-field"),l=!!c.includes("toolset-blocks/fields-and-text"),(t||a||l||s||u)&&!Object(n.select)(g.dynamicSourcesStore).getCacheUpdating()){e.next=9;break}return e.abrupt("return");case 9:return p=Object(n.select)(g.dynamicSourcesStore).getPreviewPost()||r.getCurrentPostId(),Object(n.dispatch)(g.dynamicSourcesStore).setCacheUpdating(!0),e.next=13,m(p);case 13:f=e.sent,Object(n.dispatch)(g.dynamicSourcesStore).setCacheUpdating(!1),Object(o.doAction)("tb.dynamicSources.actions.cache.tick",f);case 16:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){O(i,n,o,c,a,"next",e)}function a(e){O(i,n,o,c,a,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}(),S=function(){Object(o.addAction)("tb.dynamicSources.actions.cache.tick","toolset-blocks",(function(e){var t=!1;e&&!Object(s.isEqual)(e,g.cache)&&(g.cache=Object.assign({},g.cache,e),t=!0),g.cacheForViews&&(t=!0),t&&Object(o.doAction)("tb.dynamicSources.actions.cache.updated")})),Object(o.addAction)("tb.dynamicSources.actions.cache.initiateFetching","toolset-blocks",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];w(e)})),window.setInterval((function(){Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching")}),3e4)};function j(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"get",value:function(e,t,r){if(e&&t){var n=r?"&view-id=".concat(r):"";return a()({path:"/toolset-dynamic-sources/v1/dynamic-sources?post-type=".concat(e.join(","),"&preview-post-id=").concat(t).concat(n)})}}}])&&j(t.prototype,r),n&&j(t,n),e}();function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){E(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var R=window.toolsetDynamicSourcesScriptData,k={dynamicSources:[]},F={setLoading:function(e,t){return{type:"SET_LOADING",blockID:e,loading:t}},setCacheUpdating:function(e){return{type:"SET_CACHE_UPDATING",cacheUpdating:e}},setPreviewPost:function(e){return{type:"SET_PREVIEW_POST",previewPost:e}},setDynamicSources:function(e){return{type:"DYNAMIC_SOURCES_SET",dynamicSources:e}},getDynamicSources:function(e,t,r,n){return{type:"DYNAMIC_SOURCES_GET",postTypes:e,previewPostID:t,viewId:n}}},A=new P,D={DYNAMIC_SOURCES_GET:function(e){return A.get(e.postTypes,e.previewPostID,e.viewId)}},T={getDynamicSources:regeneratorRuntime.mark((function e(t,r,n,o){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.getDynamicSources(t,r,n,o);case 2:return i=e.sent,e.next=5,F.setDynamicSources(i);case 5:case"end":return e.stop()}}),e)}))},I={actions:F,selectors:{getLoading:function(e,t){return!!e[t]&&e[t].loading},getCacheUpdating:function(e){return!!e.cacheUpdating&&e.cacheUpdating},getPreviewPost:function(e){return e.previewPost?e.previewPost:null},getDynamicSources:function(e,t,r,n){return e.dynamicSources}},controls:D,resolvers:T,reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LOADING":return C({},e,E({},t.blockID,{loading:t.loading}));case"SET_CACHE_UPDATING":return C({},e,{cacheUpdating:!!t.cacheUpdating});case"SET_PREVIEW_POST":return C({},e,{previewPost:parseInt(t.previewPost)});case"DYNAMIC_SOURCES_SET":return C({},e,{dynamicSources:t.dynamicSources})}return e}},x=r(3),U=r(5),M=r(6),L=r(9),N=r(7);r(10);function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var B=function(){function e(){var t,r,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n="/toolset-dynamic-sources/v1",(r="baseUrl")in(t=this)?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}var t,r,n;return t=e,(r=[{key:"savePreviewPostId",value:function(e,t){return a()({path:"".concat(this.baseUrl,"/preview-post?ctId=").concat(e,"&previewPostId=").concat(t),method:"POST"})}}])&&V(t.prototype,r),n&&V(t,n),e}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function K(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $=window.toolsetDynamicSourcesScriptData,X=function(e){function t(e){var r,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=q(t).call(this,e),r=!o||"object"!==G(o)&&"function"!=typeof o?Q(n):o,z(Q(r),"savePreviewPostId",(function(e,t){(new B).savePreviewPostId(e,t)})),z(Q(r),"updateBlockContentFromCache",(function(){r.setState({postUrl:$.cache.__current_post["post-url"],postId:$.cache.__current_post["post-id"]})})),z(Q(r),"maybeRenderUpdatingCacheSpinner",(function(){var e=null;return r.props.isCacheUpdating&&(e=React.createElement("div",{className:"spinner-control"},React.createElement(U.Spinner,null))),e})),z(Q(r),"makePreviewUrl",(function(){var e=r.state.postUrl;return r.state.postId!==r.state.selectedPost.value&&(e=r.state.selectedPost.guid),Object(L.addQueryArgs)(e,{"content-template-id":r.props.currentPostId})})),z(Q(r),"maybeRenderPreviewLink",(function(){return React.createElement("span",{className:"editor-post-view"},React.createElement("a",{target:"wp-preview-"+r.props.currentPostId,rel:"noopener noreferrer",href:r.makePreviewUrl()},Object(i.__)("View on front-end","wpv-views")),!!r.props.hasChangedContent&&React.createElement("small",null,Object(i.__)("(Click Update button first to view the recent changes)","wpv-views")))})),r.state={selectedPost:Object(s.find)($.previewPosts,["value",parseInt(r.props.previewPost)]),postUrl:$.cache.__current_post["post-url"],postId:$.cache.__current_post["post-id"]},Object(s.get)(r.props.currentPost,"meta.tb_preview_post",!1)||r.savePreviewPostId(r.props.currentPostId,r.props.previewPost),r}var r,n,c,u,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){Object(o.addAction)("tb.dynamicSources.actions.cache.updated","dynamic-source-post-selector",this.updateBlockContentFromCache)}},{key:"updateDynamicSourceFromPostId",value:(u=regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a()({path:"/toolset-dynamic-sources/v1/search-post?id=".concat(t)});case 2:if(!(r=e.sent)||!r.length){e.next=8;break}return e.next=6,a()({path:"toolset-dynamic-sources/v1/get-source?post_type=".concat(r[0].post_type,"&post_id=").concat(r[0].id)});case 6:n=e.sent,$.dynamicSources.__current_post=n.__current_post;case 8:case"end":return e.stop()}}),e)})),l=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=u.apply(e,t);function i(e){H(o,r,n,i,c,"next",e)}function c(e){H(o,r,n,i,c,"throw",e)}i(void 0)}))},function(e){return l.apply(this,arguments)})},{key:"render",value:function(){var e=this;if(!$.previewPosts||$.previewPosts.length<1)return null;var t=Object(s.maxBy)($.previewPosts,(function(e){return e.label.length})),r=$.previewPosts&&$.previewPosts.length>0?5*t.label.length+120:0,n={container:function(e){return Y({},e,{width:"180px"})},menu:function(e){return Y({},e,{width:"".concat(r,"px")})}};return React.createElement(x.Fragment,null,React.createElement("label",{htmlFor:"post-selector-".concat(this.props.instanceId)},Object(i.__)("View with","wpv-views"),": "),React.createElement(N.Select,{id:"post-selector-".concat(this.props.instanceId),value:this.state.selectedPost,defaultOptions:$.previewPosts,restInfo:{base:"/wp/v2/search",args:{search:"%s",type:"post",subtype:$.previewPostTypes}},onChange:function(t){e.updateDynamicSourceFromPostId(t.value),e.setState({selectedPost:t}),e.props.setPreviewPost(t.value),e.props.editPost({meta:{tb_preview_post:t.value}}),e.savePreviewPostId(e.props.currentPostId,t.value),Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching",!0)},className:"toolset-blocks-post-selector-control",styles:n}),this.maybeRenderPreviewLink(),this.maybeRenderUpdatingCacheSpinner())}}])&&K(r.prototype,n),c&&K(r,c),t}(x.Component),Z=Object(M.compose)([Object(n.withSelect)((function(e){var t=e($.dynamicSourcesStore),r=t.getPreviewPost,n=t.getCacheUpdating,o=e("core/editor"),i=o.getCurrentPost,c=o.getCurrentPostId,a=o.hasChangedContent;return{previewPost:r(),isCacheUpdating:n(),currentPostId:c(),hasChangedContent:a(),currentPost:i()}})),Object(n.withDispatch)((function(e){var t=e("core/editor").editPost;return{setPreviewPost:e($.dynamicSourcesStore).setPreviewPost,editPost:t}})),M.withInstanceId])(X);function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){return!t||"object"!==ee(t)&&"function"!=typeof t?oe(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ce(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ae=window.toolsetDynamicSourcesScriptData,se=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(te(this,t),ce(oe(e=re(this,ne(t).call(this,r))),"PLACEHOLDER_ID","toolset-blocks-post-selector"),ce(oe(e),"deferAddingPostSelector",(function(t){var r=Object(n.select)("core/editor").getCurrentPostType;if(0!==jQuery("body").length){var o=jQuery("#editor.block-editor__container");if(0!==o.length)0!==o.find(".edit-post-header-toolbar").length?Object(s.isEqual)("view-template",r())&&e.addPostSelector():setTimeout(Object(s.partial)(t,t),1);else setTimeout(Object(s.partial)(t,t),1)}else setTimeout(Object(s.partial)(t,t),1)})),ce(oe(e),"addPostSelector",(function(){var t=jQuery("#editor.block-editor__container .edit-post-header-toolbar");0!==t.length&&(t.append('<div id="'.concat(e.PLACEHOLDER_ID,'"></div>')),Object(x.render)(React.createElement(Z,null),document.querySelector("#"+e.PLACEHOLDER_ID)))})),!Object(n.select)(ae.dynamicSourcesStore).getPreviewPost()){var o=Object(s.find)(ae.previewPosts,["value",parseInt(ae.postPreview)]);o&&Object(s.has)(o,"value")&&Object(n.dispatch)(ae.dynamicSourcesStore).setPreviewPost(Object(s.get)(o,"value"))}return e.deferAddingPostSelector(e.deferAddingPostSelector),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ie(e,t)}(t,e),t}(x.Component);function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){he(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function de(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function be(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?me(e):t}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function he(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Oe=window,ge=Oe.toolsetDynamicSourcesScriptData,we=Oe.Toolset,Se=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return de(this,t),he(me(e=be(this,ye(t).call(this,r))),"postTypes",[]),he(me(e),"previewPostId",null),he(me(e),"viewStoreIds",[]),he(me(e),"random",null),he(me(e),"viewId",null),he(me(e),"maybeAppendPostProvidersForCustomPost",(function(e){var t=ge.postProviders.filter((function(e){return u(e.value)&&"__custom_post"!==e.value})),r=[].concat(fe(e),fe(t));return r.filter((function(e,t){return r.indexOf(e)===t}))})),he(me(e),"maybeAppendDynamicSourcesForCustomPost",(function(e){var t=Object.keys(ge.dynamicSources).filter((function(e){return u(e)&&"__custom_post"!==e})).reduce((function(e,t){return e[t]=ge.dynamicSources[t],e}),{});return Object(s.merge)(e,t)})),he(me(e),"maybeAppendCacheForCustomPost",(function(e){var t=Object.keys(ge.cache).filter((function(e){return u(e)&&"__custom_post"!==e})).reduce((function(e,t){return e[t]=ge.cache[t],e}),{});return Object(s.merge)(e,t)})),he(me(e),"blockInsideViewAdjustmentCallback",(function(t,r,o){var i=e.maybeGetParentViewBlock(r);if(i){var c=Object(n.select)(i.attributes.reduxStoreId).getGeneral().preview_post_id;if(ge["".concat(o,"ForViews")]&&ge["".concat(o,"ForViews")][c])return ge["".concat(o,"ForViews")][c]}return t})),he(me(e),"maybeGetParentViewBlock",(function(e){var t=Object(n.select)("core/block-editor"),r=t.getBlock,o=t.getBlockRootClientId,i=null,c=e;do{if(c=o(c)){var a=r(c);Object(s.includes)(["toolset-views/view-editor","toolset-views/wpa-editor"],a.name)&&(i=a)}}while(c);return i})),Object(o.addAction)("tb.dynamicSources.actions.cache.initiateFetching","toolset-blocks",(function(){Object(n.select)("core/block-editor").getBlocks().filter((function(e){return"toolset-views/view-editor"===e.name})).forEach((function(e){var t=e.attributes.reduxStoreId,r=Object(n.select)(t).getGeneral(),i=Object(n.select)(t).getContentSelection();"posts"===i.query_type&&(Object(o.doAction)("tb.dynamicSources.action.updateSources",i.post_type,r.preview_post_id,t),Object(o.doAction)("toolset.views.updatePreview",t,!0))}))})),Object(o.addFilter)("tb.dynamicSources.filters.adjustPreviewPostID","toolset-blocks",(function(t,r){var o=e.maybeGetParentViewBlock(r);return o?Object(n.select)(o.attributes.reduxStoreId).getGeneral().preview_post_id:t})),Object(o.addFilter)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews","toolset-blocks",(function(t,r){return e.blockInsideViewAdjustmentCallback(t,r,"dynamicSources")})),Object(o.addFilter)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews","toolset-blocks",(function(t,r){return e.blockInsideViewAdjustmentCallback(t,r,"postProviders")})),Object(o.addAction)("tb.dynamicSources.action.updateSources","toolset-blocks",(function(t,r,o){e.postTypes=t,e.random=Math.random(),e.previewPostId=r,e.viewStoreIds[r]&&!e.viewStoreIds[r].includes(o)?e.viewStoreIds[r]=[].concat(fe(e.viewStoreIds[r]),[o]):e.viewStoreIds[r]=[o],e.viewId=Object(n.select)(o).getGeneral().id,Object(n.select)(ge.dynamicSourcesStore).getDynamicSources(e.postTypes,e.previewPostId,e.random,e.viewId)})),Object(o.addAction)("tb.dynamicSources.actions.providers.customPostLoaded","toolset-blocks",(function(t,r){e.previewPostId&&(ge.postProvidersForViews[e.previewPostId]||(ge.postProvidersForViews[e.previewPostId]=[]),ge.postProvidersForViews[e.previewPostId].find((function(e){return e.value===t}))||ge.postProvidersForViews[e.previewPostId].push({value:t,label:r}))}),10,3),Object(o.addAction)("tb.dynamicSources.actions.source.customPostLoaded","toolset-blocks",(function(t,r){e.previewPostId&&(ge.dynamicSourcesForViews[e.previewPostId]||(ge.dynamicSourcesForViews[e.previewPostId]={}),ge.dynamicSourcesForViews[e.previewPostId][t]||(ge.dynamicSourcesForViews[e.previewPostId][t]=r.__current_post))}),10,2),Object(o.addAction)("tb.dynamicSources.actions.cache.customPostLoaded","toolset-blocks",(function(t,r){e.previewPostId&&(ge.cacheForViews[e.previewPostId]||(ge.cacheForViews[e.previewPostId]={}),ge.cacheForViews[e.previewPostId][t]||(ge.cacheForViews[e.previewPostId][t]=r.__current_post))}),10,2),we.hooks.addFilter("wpv-filter-wpv-shortcodes-gui-post-id-for-dialog-create",(function(t){return e.previewPostId||t})),Object(n.subscribe)((function(){if(!(e.postTypes.length<=0)){var t=Object(n.select)(ge.dynamicSourcesStore).getDynamicSources(e.postTypes,e.previewPostId,e.random,e.viewId);if(t&&t.previewPostId){var r={},i={},c={};i[t.previewPostId]=e.maybeAppendPostProvidersForCustomPost(t.postProviders),r[t.previewPostId]=e.maybeAppendDynamicSourcesForCustomPost(t.dynamicSources),c[t.previewPostId]=e.maybeAppendCacheForCustomPost(t.cache),Object(s.isEqual)(ge.postProvidersForViews,i)&&Object(s.isEqual)(ge.dynamicSourcesForViews,r)||(ge.postProvidersForViews=Object(s.merge)(ge.postProvidersForViews,i),ge.dynamicSourcesForViews=Object(s.merge)(ge.dynamicSourcesForViews,r),Object(o.doAction)("tb.dynamicSources.actions.sourceAndProvidersForViewsUpdated"));var a=!1,u=pe({},ge.cacheForViews,{},c);JSON.stringify(u)!==JSON.stringify(ge.cacheForViews)&&(a=!0,ge.cacheForViews=u,e.viewStoreIds[t.previewPostId].forEach((function(e){Object(o.doAction)("toolset.views.updatePreview",e)}))),e.previewPostId,t.previewPostId,a&&Object(o.doAction)("tb.dynamicSources.actions.cache.tick")}}})),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(t,e),t}(x.Component),je=function(e){switch(e.constructor){case Array:return e.length?e[0]:"";case Object:var t=Object.keys(e);return t.length?e[t[0]]:"";default:return e.toString()}};function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ce(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?Re(e):t}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ae=window.toolsetDynamicSourcesScriptData,De=function(e){function t(){var e,r;_e(this,t);for(var i=arguments.length,c=new Array(i),a=0;a<i;a++)c[a]=arguments[a];return Fe(Re(r=Ce(this,(e=Ee(t)).call.apply(e,[this].concat(c)))),"componentDidUpdate",(function(e){r.props.previewPost!==e.previewPost&&(Object(n.select)(Ae.dynamicSourcesStore).getCacheUpdating()||Object(o.doAction)("tb.dynamicSources.actions.cache.initiateFetching"))})),Fe(Re(r),"render",(function(){return null})),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(t,e),t}(x.Component),Te=Object(M.compose)([Object(n.withSelect)((function(e){return{previewPost:(0,e(Ae.dynamicSourcesStore).getPreviewPost)()}}))])(De);function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(){return(xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Le(e,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=Object(M.createHigherOrderComponent)((function(e){var t=function(t){function r(){return Ue(this,r),Le(this,Ne(r).apply(this,arguments))}var n,o,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(r,t),n=r,(o=[{key:"render",value:function(){return React.createElement(x.Fragment,null,React.createElement(Te,xe({},this.props.ownProps,this.mergeProps)),React.createElement(e,xe({},this.props.ownProps,this.mergeProps)))}}])&&Me(n.prototype,o),i&&Me(n,i),r}(x.Component);return function(e){return React.createElement(t,{ownProps:e})}}),"withPostPreview");function Ge(e){return(Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function He(e,t){return!t||"object"!==Ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ke(e){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qe(e,t){return(qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe="tb-dynamic-container",Je=function(e){function t(){return We(this,t),He(this,Ke(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qe(e,t)}(t,e),r=t,(n=[{key:"filterUnusedDynamics",value:function(e){Array.isArray(e)||(e=[e]);var t=[];return e.map((function(e){e.source&&e.provider&&t.push(e)})),t}},{key:"getShortcodeStart",value:function(e){if(0===e.length)return"";var t="[".concat(Qe),r=[],n=[],o=[],i=[];return e.map((function(e){e.customPost?r.push(e.customPost.value):r.push(e.provider),n.push(e.source),o.push(e.field?e.field:""),(e["default-value"]||0===e["default-value"])&&i.push(e["default-value"])})),t+=" provider='".concat(r.join("#+*#"),"'"),t+=" source='".concat(n.join("#+*#"),"'"),t+=" field='".concat(o.join("#+*#"),"'"),i.length&&(t+=" default-value='".concat(i.join("#+*#"),"'")),t+="]"}},{key:"getShortcodeEnd",value:function(e){return 0===e.length?"":"[/".concat(Qe,"]")}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.requiredDynamics,n=this.filterUnusedDynamics(r);return React.createElement(x.Fragment,null,this.getShortcodeStart(n),t,this.getShortcodeEnd(n))}}])&&Ye(r.prototype,n),o&&Ye(r,o),t}(x.Component);r(11);function ze(e){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ze(e,t){return!t||"object"!==ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt=function(e){function t(){return $e(this,t),Ze(this,et(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){return React.createElement(x.Fragment,null,Object(i.__)("This content is coming from a Dynamic Source. Use the Settings Sidebar to change its source.","wpv-views"))}}])&&Xe(r.prototype,n),o&&Xe(r,o),t}(x.Component);function nt(e){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ot(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function it(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ct(e,t){return!t||"object"!==nt(t)&&"function"!=typeof t?st(e):t}function at(e){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function lt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var pt=window.toolsetDynamicSourcesScriptData,ft=function(e){function t(){var e,r;ot(this,t);for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];return lt(st(r=ct(this,(e=at(t)).call.apply(e,[this].concat(o)))),"maybeRenderLoadingSpinner",(function(){var e=null;return r.props.loading&&(e=React.createElement(U.Spinner,{key:"tb-spinner"})),e})),lt(st(r),"renderOverlayWithSpiner",(function(){return React.createElement("div",{className:"tb-overlay wp-block-embed is-loading",key:"tb-overlay"},React.createElement(U.Spinner,null))})),lt(st(r),"renderEditWrapperContent",(function(){var e=[r.props.children];return r.props.loading&&e.push(r.renderOverlayWithSpiner()),React.createElement(x.Fragment,null,e)})),lt(st(r),"renderDynamicContentBreadcrumb",(function(){var e=r.props,t=e.isSelected,n=e.hasDynamicSource;if(t&&n)return React.createElement("div",{className:"editor-block-list__breadcrumb block-editor-block-list__breadcrumb"},React.createElement(U.Toolbar,null,React.createElement(x.Fragment,null,r.maybeRenderLoadingSpinner(),React.createElement("span",{className:"breadcrumb-label"},Object(i.__)("Dynamic Content","wpv-views")))))})),lt(st(r),"renderEditWrapper",(function(){var e=r.props.hasDynamicSource,t="wp-block-toolset-blocks-wrapper";return React.createElement("div",{className:e?"".concat(t," dynamic"):t},r.renderEditWrapperContent())})),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.hasDynamicSource,r=e.disableTooltip,n=void 0!==r&&r,o=this.renderEditWrapper();return t&&!n&&(o=React.createElement(N.Tooltip,{text:React.createElement(rt,null),trigger:"mouseenter focus click",maxWidth:"500"},o)),o}}])&&it(r.prototype,n),o&&it(r,o),t}(x.Component),dt=Object(M.compose)([Object(n.withSelect)((function(e,t){return{loading:(0,e(pt.dynamicSourcesStore).getLoading)(t.clientId)}}))])(ft);function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gt=function(e){function t(){return yt(this,t),vt(this,ht(t).apply(this,arguments))}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.props,t=e.hasDynamicSource,r=e.children;if(!t)return null;var n=React.createElement("div",{className:"tb-field__overlay"});return r&&(n=React.createElement("div",{className:"tb-field__overlay"},r)),React.createElement(N.Tooltip,{text:React.createElement(rt,null),trigger:"mouseenter focus click",maxWidth:"500"},n)}}])&&mt(r.prototype,n),o&&mt(r,o),t}(x.Component);function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function jt(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function Pt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){jt(i,n,o,c,a,"next",e)}function a(e){jt(i,n,o,c,a,"throw",e)}c(void 0)}))}}function _t(){return(_t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ct(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Et(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(r),!0).forEach((function(t){Dt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ct(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Rt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ft(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Dt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Tt=window.toolsetDynamicSourcesScriptData,It=function(e){function t(e){var r,n,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,c=kt(t).call(this,e),r=!c||"object"!==wt(c)&&"function"!=typeof c?Ft(n):c,Dt(Ft(r),"DEFAULT_POST_PROVIDER",null),Dt(Ft(r),"ungroupedSources",[]),Dt(Ft(r),"componentDidUpdate",(function(e){if(r.props.previewPost!==e.previewPost&&r.ungroupedSources.length&&r.props.dynamicSourcesEligibleAttribute.sourceObject){var t=Object(s.find)(r.ungroupedSources,{value:r.props.dynamicSourcesEligibleAttribute.sourceObject}),n=t.fields.length>0?Object(s.find)(t.fields,{value:r.props.dynamicSourcesEligibleAttribute.fieldObject}):null;r.dynamicSourceSelectChanged(t),r.dynamicSourceFieldSelectChanged(n)}})),Dt(Ft(r),"customStyles",{menu:function(e){return Et({},e,{position:"relative"})},input:function(e,t){return Et({},e,{"& input:focus":{boxShadow:(t.isFocused,"none !important")}})}}),Dt(Ft(r),"filterSources",(function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.postType,i=e.clientId,c=e.componentId,a="__custom_post"===t.postProviderObject&&t.customPostObject?t.customPostObject.value:t.postProviderObject||r.DEFAULT_POST_PROVIDER,u=Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews",Tt.dynamicSources,i),l=c?Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocks",u,c):u,p=Object(s.cloneDeep)(l[a]);return p.forEach((function(e){e.options=e.options.filter((function(e){var i=function(e,t){if(!t)return!0;var r=Array.isArray(t)?t:[t];return!e.filter((function(e){return r.includes(e)})).length},c=Object(o.applyFilters)("toolsetViews.filters.getParentViewBlock",null,r.props.clientId),a=Object(o.applyFilters)("toolsetViews.filters.getViewEditorBlockTypes",null);if("post-content"===e.value&&"view-template"!==n&&!Object(s.isUndefined)(a.BLOCK_ID_EDITOR)&&a.BLOCK_ID_EDITOR!==Object(s.get)(c,"name",null))return!1;if(r.ungroupedSources.push(e),Object(s.has)(e,"fields")&&!Object(s.isEmpty)(e.fields)){var u=Object(s.find)(e.fields,(function(e){return!!i(e.categories,t.bannedCategories)&&Object(s.includes)(e.categories,t.category)}));return!Object(s.isEmpty)(u)}return!!i(e.categories,t.bannedCategories)&&Object(s.includes)(e.categories,t.category)}))})),p})),Dt(Ft(r),"renderDynamicPostProviderSelect",(function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.clientId,c=r.props.hideLabels||!0;t.postProviderObject||t.selectPostProviderChangedCallback(r.DEFAULT_POST_PROVIDER);var a=Object(o.applyFilters)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews",Tt.postProviders,n),u=Object(s.find)(a,{value:t.postProviderObject}),l=c?{placeholder:Object(i.__)("Select a Post Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"post-provider-select"},React.createElement(U.BaseControl,{label:!!c&&Object(i.__)("Post Source","wpv-views")},React.createElement(N.Select,_t({options:a,styles:r.customStyles},l,{value:u,onChange:function(e){t.selectPostProviderChangedCallback(e.value),t.selectCustomPostChangedCallback(null),t.selectSourceChangedCallback(null),t.selectFieldChangedCallback(null),t.sourceContentFetchedCallback("")}}))))})),Dt(Ft(r),"dynamicSourceSelectChanged",function(){var e=Pt(regeneratorRuntime.mark((function e(t){var n,i,c,a,s,u,l,p,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(o.doAction)("tb.dynamicSources.actions.source.changed",t),n=r.props.dynamicSourcesEligibleAttribute,i=null!==t?t.value:null,n.selectSourceChangedCallback(i),n.selectFieldChangedCallback(null),!t||0!==t.fields.length){e.next=15;break}return c=r.props,a=c.clientId,s=c.setLoading,u=c.post,l=c.previewPost,p=n.postProviderObject||r.DEFAULT_POST_PROVIDER,s(a,!0),f=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",l||u,a),e.next=12,r.fetchDynamicContent(p,f,i);case 12:null===(d=e.sent)?n.sourceContentFetchedCallback(""):n.sourceContentFetchedCallback(d),s(a,!1);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Dt(Ft(r),"renderDynamicSourceSelect",(function(){var e=r.props.dynamicSourcesEligibleAttribute,t=r.props.hideLabels||!0,n=r.filterSources(),o=Object(s.find)(r.ungroupedSources,{value:e.sourceObject})||null;if("__custom_post"===e.postProviderObject&&!e.customPostObject)return null;var c=t?{placeholder:Object(i.__)("Select a Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-source-select"},React.createElement(U.BaseControl,{label:!!t&&Object(i.__)("Source","wpv-views")},React.createElement(N.Select,_t({isClearable:!0,options:n,styles:r.customStyles},c,{value:o,onChange:r.dynamicSourceSelectChanged}))))})),Dt(Ft(r),"dynamicSourceFieldSelectChanged",function(){var e=Pt(regeneratorRuntime.mark((function e(t){var n,i,c,a,s,u,l,p,f,d,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(o.doAction)("tb.dynamicSources.actions.field.changed",t),n=r.props.dynamicSourcesEligibleAttribute,i=null!==t?t.value:null,n.selectFieldChangedCallback(i),!i){e.next=16;break}return c=r.props,a=c.clientId,s=c.setLoading,u=c.post,l=c.previewPost,s(a,!0),p=n.postProviderObject,f=n.sourceObject,n.sourceContentFetchedCallback(""),d=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",l||u,a),e.next=13,r.fetchDynamicContent(p,d,f,i);case 13:b=e.sent,n.sourceContentFetchedCallback(b),s(a,!1);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Dt(Ft(r),"renderDynamicSourceSearchPost",(function(){var e=r.props.dynamicSourcesEligibleAttribute,t=r.props.hideLabels||!0;if("__custom_post"!==e.postProviderObject)return null;var n=t?{placeholder:Object(i.__)("Start typing to search...","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-custom-post-select"},React.createElement(U.BaseControl,{label:!!t&&Object(i.__)("Post","wpv-views")},React.createElement(N.AsyncSelect,_t({isClearable:!0,defaultOptions:!0,cacheOptions:!0,loadOptions:v.bind(Ft(r)),onChange:r.customPostSelectChanged,styles:r.customStyles},n,{value:e.customPostObject}))))})),Dt(Ft(r),"customPostSelectChanged",function(){var e=Pt(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.dynamicSourcesEligibleAttribute,e.next=3,r.loadSourceFromCustomPost(t);case 3:n.selectCustomPostChangedCallback(t),n.selectSourceChangedCallback(null),n.selectFieldChangedCallback(null),n.sourceContentFetchedCallback("");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Dt(Ft(r),"renderDynamicSourceFieldsSelect",(function(){var e=r.props.dynamicSourcesEligibleAttribute,t=r.props.hideLabels||!0;if(e.sourceObject){var n=Object(s.find)(r.ungroupedSources,["value",e.sourceObject]),o=n?n.fields:[];if(o=Object(s.filter)(o,(function(t){return Object(s.includes)(t.categories,e.category)})),Object(s.isEmpty)(o))return;var c=1===Object.keys(o).length?o:null,a=["image","video","audio"].includes(e.category)?Object(s.find)(o,{value:e.fieldObject}):Object(s.find)(o,{value:e.fieldObject})||c;a&&a===c&&r.dynamicSourceFieldSelectChanged(a[0]);var u=t?{placeholder:Object(i.__)("Select a Field","wpv-views")}:{};return React.createElement(U.BaseControl,{label:!!t&&Object(i.__)("Field","wpv-views"),key:"dynamic-source-fields-select"},React.createElement(N.Select,_t({isClearable:!0,options:o,styles:r.customStyles},u,{value:a,onChange:r.dynamicSourceFieldSelectChanged})))}})),Dt(Ft(r),"renderDynamicSourcesInfoMessages",(function(){return Object.keys(r.state.infoMessageQueue).length<=0?null:Object.keys(r.state.infoMessageQueue).map((function(e){return React.createElement(U.Notice,{status:"info",key:e,isDismissible:!1},r.state.infoMessageQueue[e])}))})),Dt(Ft(r),"renderDynamicSourceSelectControls",(function(){if(r.props.dynamicSourcesEligibleAttribute.condition)return[r.renderDynamicPostProviderSelect(),r.renderDynamicSourceSearchPost(),r.renderDynamicSourceSelect(),r.renderDynamicSourceFieldsSelect()]})),Dt(Ft(r),"renderDynamicSourceToggleControl",(function(){var e=r.props.dynamicSourcesEligibleAttribute;return e.toggleHide||!1?null:React.createElement(U.ToggleControl,{label:e.label,checked:e.condition,onChange:e.toggleChangedCallback})})),Dt(Ft(r),"renderDynamicSourceControls",(function(){var e=r.props,t=e.clientId,n=e.dynamicSourcesEligibleAttribute,o=n.attributeKey?"-"+n.attributeKey:"";if(n)return React.createElement("div",{className:t+o},r.renderDynamicSourceToggleControl(),r.renderDynamicSourceSelectControls(),r.renderDynamicSourcesInfoMessages())})),r.DEFAULT_POST_PROVIDER=Tt.postProviders[0].value,r.state={infoMessageQueue:{}},Object(o.addAction)("tb.dynamicSources.actions.field.changed","toolset-blocks",(function(e){var t=r.state.infoMessageQueue;e&&"rfg"===e.type?t.rfg=React.createElement(x.Fragment,null,React.createElement("p",{dangerouslySetInnerHTML:{__html:Object(i.sprintf)(Object(i.__)("%1$s is a Repeating Field Group. If you want to display its fields here, put another View block into this Loop item and choose %1$s in the Content Selection step of the View wizard.","wpv-views"),"<strong>".concat(e.label,"</strong>"))}})):delete t.rfg,r.setState({infoMessageQueue:t})})),Object(o.addAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount","toolset-blocks",(function(e){if(e===r.props.clientId){var t=r.props.dynamicSourcesEligibleAttribute,n=Object(s.find)(r.ungroupedSources,{value:t.sourceObject})||null;if(n){Object(o.doAction)("tb.dynamicSources.actions.source.changed",n);var i=n.fields.length>0?Object(s.find)(n.fields,{value:t.fieldObject}):null;i&&Object(o.doAction)("tb.dynamicSources.actions.field.changed",i)}}})),r}var r,n,c,a,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){Object(o.doAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount",this.props.clientId)}},{key:"componentWillMount",value:(u=Pt(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.props.dynamicSourcesEligibleAttribute).customPostObject||Tt.dynamicSources[t.customPostObject.value]){e.next=4;break}return e.next=4,this.loadSourceFromCustomPost(t.customPostObject);case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"loadSourceFromCustomPost",value:(a=Pt(regeneratorRuntime.mark((function e(t){var r,n,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props,n=r.clientId,o=r.dynamicSourcesEligibleAttribute,(i=r.setLoading)(n,!0),e.next=4,h(t);case 4:c=t.value,o.postProviderObject=c,i(n,!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"isCustomPostProvider",value:function(e){return e.match(/^custom_post_type\|[^\|]+\|\d+$/)||"__custom_post"===e}},{key:"fetchDynamicContent",value:function(e,t,r,n){var o=this.props.dynamicSourcesEligibleAttribute;if(!o.customPostObject)return y(e,t,r,n);var i=this.isCustomPostProvider(e),c=St((i?o.customPostObject.value:"").split("|"),2)[1],a=i?c:t,s=i?o.customPostObject.value:e;return y(s,a,r,n)}},{key:"render",value:function(){return this.renderDynamicSourceControls()}}])&&Rt(r.prototype,n),c&&Rt(r,c),t}(x.Component),xt=Object(M.compose)([Object(n.withSelect)((function(e){var t=e("core/editor"),r=t.getCurrentPostId,n=t.getCurrentPostType,o=e(Tt.dynamicSourcesStore).getPreviewPost;return{post:r(),postType:n(),previewPost:o()}})),Object(n.withDispatch)((function(e){var t=e("core/notices").createErrorNotice,r=e(Tt.dynamicSourcesStore);return{createErrorNotice:t,setLoading:r.setLoading,setPreviewPost:r.setPreviewPost}}))])(It);function Ut(e){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(n=(c=a.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Lt(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function Nt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){Lt(i,n,o,c,a,"next",e)}function a(e){Lt(i,n,o,c,a,"throw",e)}c(void 0)}))}}function Vt(){return(Vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Bt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Bt(Object(r),!0).forEach((function(t){qt(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Wt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Yt(e){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kt(e,t){return(Kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Qt=window.toolsetDynamicSourcesScriptData,Jt=function(e){function t(e){var r,n,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,c=Yt(t).call(this,e),r=!c||"object"!==Ut(c)&&"function"!=typeof c?Ht(n):c,qt(Ht(r),"DEFAULT_POST_PROVIDER",null),qt(Ht(r),"ungroupedSources",[]),qt(Ht(r),"componentDidUpdate",(function(e,t){if(r.props.previewPost!==e.previewPost&&r.ungroupedSources.length&&r.props.dynamicSourcesEligibleAttribute.sourceObject){var n=Object(s.find)(r.ungroupedSources,{value:r.props.dynamicSourcesEligibleAttribute.sourceObject}),o=n.fields.length>0?Object(s.find)(n.fields,{value:r.props.dynamicSourcesEligibleAttribute.fieldObject}):null;r.dynamicSourceSelectChanged(n),r.dynamicSourceFieldSelectChanged(o)}t.postProvider===r.state.postProvider&&t.source===r.state.source&&t.field===r.state.field||(r.state.customPost&&!Qt.dynamicSources[r.state.customPost.value]&&r.loadSourceFromCustomPost(r.state.customPost),r.state.postProvider&&r.state.source&&r.state.field?(r.props.dynamicSourcesEligibleAttribute.fieldSelectedCallback({postProvider:r.state.postProvider,source:r.state.source,field:r.state.field,customPost:r.state.customPost}),r.setState({fieldWasSelected:!0})):r.state.postProvider&&r.state.source&&!r.state.source.includes("|")?(r.props.dynamicSourcesEligibleAttribute.fieldSelectedCallback({postProvider:r.state.postProvider,source:r.state.source,field:null,customPost:r.state.customPost}),r.setState({fieldWasSelected:!0})):r.state.fieldWasSelected&&(r.props.dynamicSourcesEligibleAttribute.fieldSelectedCallback(null),r.setState({fieldWasSelected:!1})))})),qt(Ht(r),"customStyles",{menu:function(e){return Gt({},e,{position:"relative"})},input:function(e,t){return Gt({},e,{"& input:focus":{boxShadow:(t.isFocused,"none !important")}})}}),qt(Ht(r),"filterSources",(function(){var e=r.props,t=e.dynamicSourcesEligibleAttribute,n=e.postType,i=e.clientId,c=e.componentId,a="__custom_post"===r.state.postProvider&&r.state.customPost?r.state.customPost.value:r.state.postProvider||r.DEFAULT_POST_PROVIDER,u=Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocksInsideViews",Qt.dynamicSources,i),l=c?Object(o.applyFilters)("tb.dynamicSources.filters.adjustSourcesForBlocks",u,c):u,p=Object(s.cloneDeep)(l[a]);return p?(p.forEach((function(e){e.options=e.options.filter((function(e){var i=function(e,t){if(!t)return!0;var r=Array.isArray(t)?t:[t];return!e.filter((function(e){return r.includes(e)})).length},c=Object(o.applyFilters)("toolsetViews.filters.getParentViewBlock",null,r.props.clientId),a=Object(o.applyFilters)("toolsetViews.filters.getViewEditorBlockTypes",null);if("post-content"===e.value&&"view-template"!==n&&!Object(s.isUndefined)(a.BLOCK_ID_EDITOR)&&a.BLOCK_ID_EDITOR!==Object(s.get)(c,"name",null))return!1;if(r.ungroupedSources.push(e),Object(s.has)(e,"fields")&&!Object(s.isEmpty)(e.fields)){var u=Object(s.find)(e.fields,(function(e){return!(t.forceRepeatable&&!e.is_repetitive)&&(!!i(e.categories,t.bannedCategories)&&Object(s.includes)(e.categories,t.category))}));return!Object(s.isEmpty)(u)}return!(t.forceRepeatable&&e.fields&&!e.fields.length)&&(!!i(e.categories,t.bannedCategories)&&Object(s.includes)(e.categories,t.category))}))})),p):[]})),qt(Ht(r),"renderDynamicPostProviderSelect",(function(){var e=r.props.clientId,t=r.props.hideLabels||!0,n=Object(o.applyFilters)("tb.dynamicSources.filters.adjustProvidersForBlocksInsideViews",Qt.postProviders,e),c=Object(s.find)(n,{value:r.state.postProvider}),a=t?{placeholder:Object(i.__)("Select a Post Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"post-provider-select"},React.createElement(U.BaseControl,{label:!!t&&Object(i.__)("Post Source","wpv-views")},React.createElement(N.Select,Vt({options:n,styles:r.customStyles},a,{value:c,onChange:function(e){return r.setState({postProvider:e.value,customPost:null,source:null,field:null})}}))))})),qt(Ht(r),"dynamicSourceSelectChanged",function(){var e=Nt(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(o.doAction)("tb.dynamicSources.actions.source.changed",t),n=null!==t?t.value:null,r.setState({source:n,field:null});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qt(Ht(r),"renderDynamicSourceSelect",(function(){var e=r.props.hideLabels||!0,t=r.filterSources(),n=Object(s.find)(r.ungroupedSources,{value:r.state.source})||null;if("__custom_post"===r.state.postProvider&&!r.state.customPost)return null;var o=e?{placeholder:Object(i.__)("Select a Source","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-source-select"},React.createElement(U.BaseControl,{label:!!e&&Object(i.__)("Source","wpv-views")},React.createElement(N.Select,Vt({isClearable:!0,options:t,styles:r.customStyles},o,{value:n,onChange:r.dynamicSourceSelectChanged}))))})),qt(Ht(r),"dynamicSourceFieldSelectChanged",function(){var e=Nt(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(o.doAction)("tb.dynamicSources.actions.field.changed",t),n=null!==t?t.value:null,r.setState({field:n});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qt(Ht(r),"renderDynamicSourceSearchPost",(function(){var e=r.props.hideLabels||!0;if("__custom_post"!==r.state.postProvider)return null;var t=e?{placeholder:Object(i.__)("Start typing to search...","wpv-views")}:{};return React.createElement(x.Fragment,{key:"dynamic-custom-post-select"},React.createElement(U.BaseControl,{label:!!e&&Object(i.__)("Post","wpv-views")},React.createElement(N.AsyncSelect,Vt({isClearable:!0,defaultOptions:!0,cacheOptions:!0,loadOptions:v.bind(Ht(r)),onChange:r.customPostSelectChanged,styles:r.customStyles},t,{value:r.state.customPost}))))})),qt(Ht(r),"customPostSelectChanged",function(){var e=Nt(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.loadSourceFromCustomPost(t);case 2:r.setState({customPost:t,source:null,field:null});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),qt(Ht(r),"renderDynamicSourceFieldsSelect",(function(){var e=r.props.dynamicSourcesEligibleAttribute,t=r.props.hideLabels||!0;if(r.state.source){var n=Object(s.find)(r.ungroupedSources,["value",r.state.source]),o=n?n.fields:[];if(o=Object(s.filter)(o,(function(t){return!(e.forceRepeatable&&!t.is_repetitive)&&Object(s.includes)(t.categories,e.category)})),Object(s.isEmpty)(o))return;var c=1===Object.keys(o).length?o:null,a=["image","video","audio"].includes(e.category)?Object(s.find)(o,{value:r.state.field}):Object(s.find)(o,{value:r.state.field})||c;a&&a===c&&r.dynamicSourceFieldSelectChanged(a[0]);var u=t?{placeholder:Object(i.__)("Select a Field","wpv-views")}:{};return React.createElement(U.BaseControl,{label:!!t&&Object(i.__)("Field","wpv-views"),key:"dynamic-source-fields-select"},React.createElement(N.Select,Vt({isClearable:!0,options:o,styles:r.customStyles},u,{value:a,onChange:r.dynamicSourceFieldSelectChanged})))}})),qt(Ht(r),"renderDynamicSourcesInfoMessages",(function(){return Object.keys(r.state.infoMessageQueue).length<=0?null:Object.keys(r.state.infoMessageQueue).map((function(e){return React.createElement(U.Notice,{status:"info",key:e,isDismissible:!1},r.state.infoMessageQueue[e])}))})),qt(Ht(r),"renderDynamicSourceSelectControls",(function(){if(r.props.dynamicSourcesEligibleAttribute.condition)return[r.renderDynamicPostProviderSelect(),r.renderDynamicSourceSearchPost(),r.renderDynamicSourceSelect(),r.renderDynamicSourceFieldsSelect()]})),qt(Ht(r),"renderDynamicSourceToggleControl",(function(){var e=r.props.dynamicSourcesEligibleAttribute;return e.toggleHide||!1?null:React.createElement(U.ToggleControl,{label:e.label,checked:e.condition,onChange:e.toggleChangedCallback})})),qt(Ht(r),"renderDynamicSourceControls",(function(){var e=r.props,t=e.clientId,n=e.dynamicSourcesEligibleAttribute,o=n.attributeKey?"-"+n.attributeKey:"";if(n)return React.createElement("div",{className:t+o},r.renderDynamicSourceToggleControl(),r.renderDynamicSourceSelectControls(),r.renderDynamicSourcesInfoMessages())})),r.DEFAULT_POST_PROVIDER=Qt.postProviders[0].value;var a=e.dynamicSourcesEligibleAttribute,u=a.postProvider,l=a.source,p=a.field,f=a.customPost,d=Boolean(u&&l&&p);return r.state={infoMessageQueue:{},postProvider:u||r.DEFAULT_POST_PROVIDER,customPost:f,source:l,field:p,fieldWasSelected:d},Object(o.addAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount","toolset-blocks",(function(e){if(e===r.props.clientId){var t=r.props.dynamicSourcesEligibleAttribute,n=Object(s.find)(r.ungroupedSources,{value:t.sourceObject})||null;if(n){Object(o.doAction)("tb.dynamicSources.actions.source.changed",n);var i=n.fields.length>0?Object(s.find)(n.fields,{value:t.fieldObject}):null;i&&Object(o.doAction)("tb.dynamicSources.actions.field.changed",i)}}})),r}var r,n,c,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kt(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){var e=this;Object(o.addAction)("tb.dynamicSources.actions.field.changed","toolset-blocks",(function(t){var r=e.state.infoMessageQueue;t&&"rfg"===t.type?r.rfg=React.createElement(x.Fragment,null,React.createElement("p",{dangerouslySetInnerHTML:{__html:Object(i.sprintf)(Object(i.__)("%1$s is a Repeating Field Group. If you want to display its fields here, put another View block into this Loop item and choose %1$s in the Content Selection step of the View wizard.","wpv-views"),"<strong>".concat(t.label,"</strong>"))}})):delete r.rfg,e.setState({infoMessageQueue:r})})),Object(o.doAction)("tb.dynamicSources.actions.dynamicSourceComponentDidMount",this.props.clientId),this.state.customPost&&!Qt.dynamicSources[this.state.customPost.value]&&this.loadSourceFromCustomPost(this.state.customPost)}},{key:"loadSourceFromCustomPost",value:(a=Nt(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(t);case 2:r=t.value,this.setState({postProvider:r});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"isCustomPostProvider",value:function(e){return e.match(/^custom_post_type\|[^\|]+\|\d+$/)||"__custom_post"===e}},{key:"fetchDynamicContent",value:function(e,t,r,n){if(!this.state.customPost)return y(e,t,r,n);var o=this.isCustomPostProvider(e),i=Mt((o?this.state.customPost.value:"").split("|"),2)[1],c=o?i:t,a=o?this.state.customPost.value:e;return y(a,c,r,n)}},{key:"render",value:function(){return this.renderDynamicSourceControls()}}])&&Wt(r.prototype,n),c&&Wt(r,c),t}(x.Component),zt=Object(M.compose)([M.pure,Object(n.withSelect)((function(e){var t=e("core/editor"),r=t.getCurrentPostId,n=t.getCurrentPostType,o=e(Qt.dynamicSourcesStore).getPreviewPost;return{post:r(),postType:n(),previewPost:o()}})),Object(n.withDispatch)((function(e){var t=e("core/notices").createErrorNotice,r=e(Qt.dynamicSourcesStore);return{createErrorNotice:t,setLoading:r.setLoading,setPreviewPost:r.setPreviewPost}}))])(Jt);function $t(){return($t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Xt(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function Zt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function er(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(r),!0).forEach((function(t){sr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function tr(e){return(tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function or(e,t){return!t||"object"!==tr(t)&&"function"!=typeof t?cr(e):t}function ir(e){return(ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ar(e,t){return(ar=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function sr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ur=window.toolsetDynamicSourcesScriptData,lr={isActive:!1,provider:null,source:null,customPost:null,field:null},pr=Object(M.createHigherOrderComponent)((function(e){return function(t){function r(){var e;return rr(this,r),sr(cr(e=or(this,ir(r).apply(this,arguments))),"maybeGetParentViewBlock",(function(e){var t=Object(n.select)("core/block-editor"),r=t.getBlock,o=t.getBlockRootClientId,i=null,c=e;do{if(c=o(c)){var a=r(c);Object(s.includes)(["toolset-views/view-editor","toolset-views/wpa-editor"],a.name)&&(i=a)}}while(c);return i})),e.dynamicFieldsRegister=e.dynamicFieldsRegister.bind(cr(e)),e.dynamicFieldControlRender=e.dynamicFieldControlRender.bind(cr(e)),e.dynamicFieldGet=e.dynamicFieldGet.bind(cr(e)),e.dynamicFieldReset=e.dynamicFieldReset.bind(cr(e)),e.dynamicFieldNoDataRender=e.dynamicFieldNoDataRender.bind(cr(e)),e.requestUpdateContent=e.requestUpdateContent.bind(cr(e)),e.requestFieldToggle=e.requestFieldToggle.bind(cr(e)),e.requestFieldAttributeUpdate=e.requestFieldAttributeUpdate.bind(cr(e)),e.doFieldsAttributeUpdate=e.doFieldsAttributeUpdate.bind(cr(e)),e.currentPostId=Object(n.select)("core/editor").getCurrentPostId(),e.attributesUpdateRequired=!1,e}var c,a,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ar(e,t)}(r,t),c=r,(a=[{key:"componentDidMount",value:function(){this.requestUpdateContent(),Object(o.hasAction)("tb.dynamicSources.actions.cache.updated","with-dynamic-field-hoc-"+this.props.clientId)||Object(o.addAction)("tb.dynamicSources.actions.cache.updated","with-dynamic-field-hoc-"+this.props.clientId,this.requestUpdateContent)}},{key:"componentWillUnmount",value:function(){Object(o.removeAction)("tb.dynamicSources.actions.cache.updated","with-dynamic-field-hoc-"+this.props.clientId)}},{key:"dynamicFieldsRegister",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dynamic";"object"===tr(e)?this.fields?Object.keys(this.fields).toString()!==Object.keys(e).toString()&&this.throwError("dynamicFieldsRegister() is called twice. Register all fields with one call."):(this.dynamicRootAttributeKey=r,this.fields={},Object.keys(e).forEach((function(n){e[n].attributeKey=e[n].attributeKey||n,t.fields[n]=er({},lr,{},t.props.attributes[r]&&t.props.attributes[r][n]?t.props.attributes[r][n]:{},{},e[n])}))):this.throwError("dynamicFieldsRegister() first parameter must be an object.")}},{key:"dynamicFieldControlRender",value:function(e){if(this.fieldExists(e))return React.createElement(zt,{clientId:this.props.clientId,dynamicSourcesEligibleAttribute:this.getFieldControlSetup(this.fields[e])})}},{key:"dynamicFieldGet",value:function(e){return this.fieldExists(e)?this.fields[e]:lr}},{key:"dynamicFieldReset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.fieldExists(e)&&this.requestFieldAttributeUpdate(this.fields[e],null,t)}},{key:"dynamicFieldNoDataRender",value:function(e){if(this.fieldExists(e)){var t=this.fields[e];return!this.props.attributes[t.attributeKey]&&t.isActive&&t.source?React.createElement("span",{style:{color:"#ccc"}},Object(i.__)("This dynamic source returned no content.","wpv-views")):null}}},{key:"fieldExists",value:function(e){return"string"!=typeof e?(this.throwError("First parameter must be a string"),!1):!(!this.fields||!this.fields[e])||(this.throwError('The requested field "'.concat(e,'" is not registered.')),!1)}},{key:"getFieldControlSetup",value:function(e){var t=this,r=e.label||Object(i.__)("Dynamic Source","wpv-views");return{attributeKey:e.attributeKey,label:r,condition:e.condition||e.isActive,postProvider:e.provider,source:e.source,field:e.field,customPost:e.customPost,toggleHide:e.toggleHide||!1,toggleChangedCallback:function(){t.requestFieldToggle(e)},fieldSelectedCallback:function(r){t.requestFieldAttributeUpdate(e,r)},category:e.category||"text",bannedCategories:e.bannedCategories||[],allowRepeatable:e.allowRepeatable||!1,forceRepeatable:e.forceRepeatable||!1,returnType:"anything"}}},{key:"updateFieldContent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&e.customContentCallback){if("function"==typeof e.customContentCallback)return e.customContentCallback(t,this.props.attributes,n),!1;this.throwError("customContentCallback must be a function.")}else{var o=t&&t.sourceContent?t.sourceContent:"";if(!1===e.allowRepeatable&&(o=je(o)),e.parse)switch(e.parse){case"int":o=parseInt(o);break;case"float":o=parseFloat(o)}if("array"===e.returnType&&o&&!Array.isArray(o)&&(o=[o]),r)return sr({},e.attributeKey,o);this.props.setAttributes(sr({},e.attributeKey,o))}}},{key:"requestFieldToggle",value:function(e){this.fields[e.attributeKey].isActive=!this.fields[e.attributeKey].isActive,this.attributesUpdateRequired=!0,this.doFieldsAttributeUpdate(),this.fields[e.attributeKey].isActive&&this.requestUpdateContent()}},{key:"requestFieldAttributeUpdate",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===r&&e.toggleHide&&(this.fields[e.attributeKey].isActive=!0),null!==r&&(this.fields[e.attributeKey].isActive=!!r),null===t?(this.fields[e.attributeKey].customPost=null,this.fields[e.attributeKey].field=null,this.fields[e.attributeKey].provider=null,this.fields[e.attributeKey].source=null):(this.fields[e.attributeKey].customPost=t.customPost,this.fields[e.attributeKey].field=t.field,this.fields[e.attributeKey].provider=t.postProvider,this.fields[e.attributeKey].source=t.source),this.attributesUpdateRequired=!0,this.doFieldsAttributeUpdate(),this.requestUpdateContent()}},{key:"doFieldsAttributeUpdate",value:function(){var e=this,t={};this.attributesUpdateRequired&&(this.attributesUpdateRequired=!1,Object.keys(this.fields).forEach((function(r){var n=function(e,t){if(void 0===t)return{};var r=Object(s.reduce)(e,(function(e,r,n){return Object(s.isEqual)(r,t[n])?e:e.concat(n)}),[]),n={};return r.forEach((function(e){n[e]=t[e]})),n}(lr,e.fields[r]);Object.keys(n).length>0&&(t[r]=n)})),this.props.setAttributes(sr({},this.dynamicRootAttributeKey,t)))}},{key:"requestUpdateContent",value:function(){var e=this,t=this.currentPostId,r=this.props,i=r.setAttributes,c=r.clientId,a=Object(o.applyFilters)("tb.dynamicSources.filters.adjustPreviewPostID",Object(n.select)(ur.dynamicSourcesStore).getPreviewPost(),c)||t;Object.keys(this.fields).map(function(){var t,r=(t=regeneratorRuntime.mark((function t(r){var o,s,u,l,p,f,d,b,m,v,h,O;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=e.fields[r],s=o.isActive,u=o.source,l=o.field,p=o.provider,f=o.customPost,s){t.next=3;break}return t.abrupt("return");case 3:return d=f?f.value:p,b=e.maybeGetParentViewBlock(c),m=null,b&&(v=Object(n.select)(b.attributes.reduxStoreId).getGeneral(),m=v.id),t.next=9,y(d,a,u,l||null,m);case 9:h=t.sent,!1!==(O=e.updateFieldContent(e.fields[r],h,!0,u))&&i(O);case 12:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function c(e){Xt(i,n,o,c,a,"next",e)}function a(e){Xt(i,n,o,c,a,"throw",e)}c(void 0)}))});return function(e){return r.apply(this,arguments)}}())}},{key:"throwError",value:function(e){console.error("[withToolsetDynamicField] ".concat(e))}},{key:"render",value:function(){return React.createElement(x.Fragment,null,React.createElement(Te,this.props),React.createElement(e,$t({},this.props,{dynamicFieldsRegister:this.dynamicFieldsRegister,dynamicFieldControlRender:this.dynamicFieldControlRender,dynamicFieldNoDataRender:this.dynamicFieldNoDataRender,dynamicFieldGet:this.dynamicFieldGet,dynamicFieldReset:this.dynamicFieldReset})))}}])&&nr(c.prototype,a),u&&nr(c,u),r}(x.Component)}),"withToolsetDynamicField");function fr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function dr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fr(Object(r),!0).forEach((function(t){br(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function br(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yr(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"current",c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{};if(e&&t){var s=dr({provider:n,post:i,source:t},a),u="[tb-dynamic";return Object.keys(s).forEach((function(e){u+=" ".concat(e,"='").concat(s[e],"'")})),r&&(u+=" field='".concat(r,"'")),c&&(u+=" force-string='".concat(c,"' ")),u+="]"}return o}var mr=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||!e.isActive||!e.source)return t;var n=r.post||"current",o=r.repeatableFieldShowOnly||!1,i=r.extraAttributes||{},c=e.customPost?e.customPost.value:e.provider;return yr(e.isActive,e.source,e.field,c,t,n,o,i)};function vr(e){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Or(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?hr(Object(r),!0).forEach((function(t){Pr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function gr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function wr(e){return(wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Sr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jr(e,t){return(jr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _r=function(e){function t(e){var r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=wr(t).call(this,e),r=!o||"object"!==vr(o)&&"function"!=typeof o?Sr(n):o,Pr(Sr(r),"COUNTBY_CHAR","char"),Pr(Sr(r),"COUNTBY_WORD","word"),Pr(Sr(r),"makeExcerpt",(function(e){var t=Or({},r.state,{},e),n="";return n=t.countBy===r.COUNTBY_CHAR?r.props.content.substring(0,t.length):r.props.content.split(" ").splice(0,t.length).join(" "),t.renderEllipsis&&n.length<r.props.content.length&&0!==n.length&&(n+=t.ellipsisText),n})),Pr(Sr(r),"modifyContent",(function(e){var t=r.props.onModifyContent;"countBy"in e&&(e.countBy===r.COUNTBY_WORD?e.maxLength=r.props.content.split(" ").length:e.maxLength=r.props.content.length,e.maxLength<r.state.length&&(e.length=e.maxLength)),r.setState(e);var n=Or({},r.state,{},e);t({content:r.makeExcerpt(e),shortcodeAttributes:n})}));var c={length:e.content?30:0,maxLength:e.content?e.content.split(" ").length:0,countBy:r.COUNTBY_WORD,renderEllipsis:!0,ellipsisText:Object(i.__)("...","wpv-views")};return r.state=e.modifiedContent?Or({},c,{},e.modifiedContent.shortcodeAttributes):c,r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jr(e,t)}(t,e),r=t,(n=[{key:"componentDidUpdate",value:function(e){var t=this.props;null===e.content&&null!==t.content&&this.modifyContent({length:t.content?30:0,maxLength:t.content?t.content.split(" ").length:0})}},{key:"render",value:function(){var e=this,t=this.state,r=t.length,n=t.maxLength,o=t.countBy,c=t.renderEllipsis,a=t.ellipsisText;return React.createElement(x.Fragment,null,React.createElement(U.RangeControl,{label:Object(i.__)("Length","wpv-views"),value:r,onChange:function(t){return e.modifyContent({length:t})},min:0,max:n}),React.createElement(U.RadioControl,{label:Object(i.__)("Count Length By","wpv-views"),selected:o,options:[{label:Object(i.__)("Characters","wpv-views"),value:this.COUNTBY_CHAR},{label:Object(i.__)("Words","wpv-views"),value:this.COUNTBY_WORD}],onChange:function(t){return e.modifyContent({countBy:t})}}),React.createElement(U.ToggleControl,{label:Object(i.__)("Show Ellipsis","wpv-views"),checked:c,onChange:function(){return e.modifyContent({renderEllipsis:!c})}}),c&&React.createElement(U.TextControl,{label:Object(i.__)("Ellipsis Text","wpv-views"),value:a,onChange:function(t){return e.modifyContent({ellipsisText:t})}}))}}])&&gr(r.prototype,n),o&&gr(r,o),t}(x.Component),Cr=Object(M.pure)(_r,"Excerpt");function Er(e){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function kr(e,t,r,n,o,i,c){try{var a=e[i](c),s=a.value}catch(e){return void r(e)}a.done?t(s):Promise.resolve(s).then(n,o)}function Fr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){kr(i,n,o,c,a,"next",e)}function a(e){kr(i,n,o,c,a,"throw",e)}c(void 0)}))}}function Ar(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dr(e){return(Dr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ir(e,t){return(Ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ur=function(e){function t(e){var r,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=Dr(t).call(this,e),r=!o||"object"!==Er(o)&&"function"!=typeof o?Tr(n):o,xr(Tr(r),"FORMAT_NAME","name"),xr(Tr(r),"FORMAT_LINK","link"),xr(Tr(r),"FORMAT_URL","url"),xr(Tr(r),"FORMAT_DESCRIPTION","description"),xr(Tr(r),"FORMAT_SLUG","slug"),xr(Tr(r),"FORMAT_COUNT","count"),xr(Tr(r),"SHOW_NAME","name"),xr(Tr(r),"SHOW_DESCRIPTION","description"),xr(Tr(r),"SHOW_SLUG","slug"),xr(Tr(r),"SHOW_COUNT","count"),xr(Tr(r),"ORDER_ASC","asc"),xr(Tr(r),"ORDER_DESC","desc"),xr(Tr(r),"makeTagLink",(function(e,t){return'<a href="//?tag='.concat(e,'">').concat(t,"</a>")})),xr(Tr(r),"getOrigin",(function(){return new URL(window.location.href).origin})),xr(Tr(r),"formatTaxonomy",Fr(regeneratorRuntime.mark((function e(){var t,n,o,i,c,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.state,n=t.separator,o=t.format,i=t.show,c=t.order,a=Array.isArray(r.props.content)?r.props.content:r.props.content.split(","),o===r.FORMAT_NAME){e.next=8;break}return e.next=6,y(r.props.postProvider,r.props.postId,"post-taxonomies-rich",r.props.postField.value);case 6:s=e.sent,a=s.sourceContent;case 8:e.t0=o,e.next=e.t0===r.FORMAT_LINK?11:e.t0===r.FORMAT_URL?23:e.t0===r.FORMAT_COUNT?25:e.t0===r.FORMAT_SLUG?27:e.t0===r.FORMAT_DESCRIPTION?29:(e.t0,r.FORMAT_NAME,31);break;case 11:e.t1=i,e.next=e.t1===r.SHOW_NAME?14:e.t1===r.SHOW_DESCRIPTION?16:e.t1===r.SHOW_SLUG?18:e.t1===r.SHOW_COUNT?20:22;break;case 14:return a=a.map((function(e){return r.makeTagLink(e.slug,e.name)})),e.abrupt("break",22);case 16:return a=a.map((function(e){return r.makeTagLink(e.slug,e.description)})),e.abrupt("break",22);case 18:return a=a.map((function(e){return r.makeTagLink(e.slug,e.slug)})),e.abrupt("break",22);case 20:return a=a.map((function(e){return r.makeTagLink(e.slug,e.count)})),e.abrupt("break",22);case 22:return e.abrupt("break",32);case 23:return a=a.map((function(e){return"".concat(r.getOrigin(),"/?tag=").concat(e.slug)})),e.abrupt("break",32);case 25:return a=a.map((function(e){return e.count})),e.abrupt("break",32);case 27:return a=a.map((function(e){return e.slug})),e.abrupt("break",32);case 29:return a=a.map((function(e){return e.description})),e.abrupt("break",32);case 31:return e.abrupt("break",32);case 32:return c===r.ORDER_DESC&&(a=a.reverse()),e.abrupt("return",a.join(n));case 34:case"end":return e.stop()}}),e)})))),xr(Tr(r),"modifyContent",function(){var e=Fr(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.onModifyContent,e.next=3,r.setState(t);case 3:return e.t0=n,e.next=6,r.formatTaxonomy();case 6:e.t1=e.sent,e.t2=r.state,e.t3={content:e.t1,shortcodeAttributes:e.t2},(0,e.t0)(e.t3);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var i={separator:", ",format:r.FORMAT_NAME,show:r.SHOW_NAME,order:r.ORDER_ASC};return r.state=e.modifiedContent?function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(r),!0).forEach((function(t){xr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},i,{},e.modifiedContent.shortcodeAttributes):i,r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ir(e,t)}(t,e),r=t,(n=[{key:"componentDidMount",value:function(){this.modifyContent({})}},{key:"render",value:function(){var e=this,t=this.state,r=t.separator,n=t.format,o=t.show,c=t.order;return React.createElement(x.Fragment,null,React.createElement(U.RadioControl,{label:Object(i.__)("Display Format","wpv-views"),selected:n,options:[{label:Object(i.__)("Link to term archive page","wpv-views"),value:this.FORMAT_LINK},{label:Object(i.__)("URL of term archive page","wpv-views"),value:this.FORMAT_URL},{label:Object(i.__)("Term name","wpv-views"),value:this.FORMAT_NAME},{label:Object(i.__)("Term description","wpv-views"),value:this.FORMAT_DESCRIPTION},{label:Object(i.__)("Term slug","wpv-views"),value:this.FORMAT_SLUG},{label:Object(i.__)("Term post count","wpv-views"),value:this.FORMAT_COUNT}],onChange:function(t){return e.modifyContent({format:t})}}),n===this.FORMAT_LINK&&React.createElement(U.RadioControl,{label:Object(i.__)("Anchor Text When Linking to the Term Archive Page","wpv-views"),selected:o,options:[{label:Object(i.__)("Term name","wpv-views"),value:this.SHOW_NAME},{label:Object(i.__)("Term description","wpv-views"),value:this.SHOW_DESCRIPTION},{label:Object(i.__)("Term slug","wpv-views"),value:this.SHOW_SLUG},{label:Object(i.__)("Term post count","wpv-views"),value:this.SHOW_COUNT}],onChange:function(t){return e.modifyContent({show:t})}}),React.createElement(U.TextControl,{label:Object(i.__)("Separator Between Terms","wpv-views"),value:r,onChange:function(t){return e.modifyContent({separator:t})}}),React.createElement(U.RadioControl,{label:Object(i.__)("Order","wpv-views"),selected:c,options:[{label:Object(i.__)("Ascending","wpv-views"),value:this.ORDER_ASC},{label:Object(i.__)("Descending","wpv-views"),value:this.ORDER_DESC}],onChange:function(t){return e.modifyContent({order:t})}}))}}])&&Ar(r.prototype,n),o&&Ar(r,o),t}(x.Component),Mr=Object(M.pure)(Ur,"Taxonomy");r(12);function Lr(e){return(Lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Nr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vr(e){return(Vr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Br(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gr(e,t){return(Gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Yr=function(e){function t(e){var r,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=Vr(t).call(this,e),r=!o||"object"!==Lr(o)&&"function"!=typeof o?Br(n):o,Wr(Br(r),"FORMAT_DEFAULT","Y-m-d H:i:s"),Wr(Br(r),"FORMAT_FJY","F j, Y"),Wr(Br(r),"FORMAT_FJYGIA","F j, Y g:i a"),Wr(Br(r),"FORMAT_DMY","d/m/y"),Wr(Br(r),"PREDEFINED_FORMATS",[r.FORMAT_DEFAULT,r.FORMAT_FJY,r.FORMAT_FJYGIA,r.FORMAT_DMY]),Wr(Br(r),"modifyFormat",(function(e){var t=r.props.onModifyContent,n=window.date_format(new Date(r.props.content),e);r.setState({format:e}),t({content:n,shortcodeAttributes:{format:e}})})),e.modifiedContent?r.state={format:e.modifiedContent.shortcodeAttributes.format,customFormat:!r.PREDEFINED_FORMATS.includes(e.modifiedContent.shortcodeAttributes.format)}:r.state={format:r.FORMAT_DEFAULT,customFormat:!1},r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gr(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this,t=this.state,r=t.format,n=t.customFormat;return React.createElement(x.Fragment,null,React.createElement(U.ToggleControl,{label:Object(i.__)("Custom format","wpv-views"),checked:n,onChange:function(){return e.setState({customFormat:!n})}}),!n&&React.createElement(U.RadioControl,{label:Object(i.__)("Date Format","wpv-views"),selected:r,options:[{label:this.FORMAT_DEFAULT,value:this.FORMAT_DEFAULT},{label:this.FORMAT_FJY,value:this.FORMAT_FJY},{label:this.FORMAT_FJYGIA,value:this.FORMAT_FJYGIA},{label:this.FORMAT_DMY,value:this.FORMAT_DMY}],onChange:function(t){return e.modifyFormat(t)}}),n&&React.createElement(x.Fragment,null,React.createElement(U.TextControl,{value:r,onChange:function(t){return e.modifyFormat(t)}}),React.createElement("p",null,React.createElement("span",null,Object(i.__)("Specific documentation: ","wpv-views")),React.createElement(U.ExternalLink,{href:"https://wordpress.org/support/article/formatting-date-and-time/"},Object(i.__)("WordPress Formatting Date and Time","wpv-views")))))}}])&&Nr(r.prototype,n),o&&Nr(r,o),t}(x.Component),Hr=Object(M.pure)(Yr,"DateTime");function Kr(e){return(Kr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Qr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Jr(e,t){return!t||"object"!==Kr(t)&&"function"!=typeof t?$r(e):t}function zr(e){return(zr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xr(e,t){return(Xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Zr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var en=function(e){function t(){var e,r;qr(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return Zr($r(r=Jr(this,(e=zr(t)).call.apply(e,[this].concat(o)))),"getFieldOption",(function(){var e=$r(r).props,t=e.postField,n=e.fieldType,o=e.content;return n&&"taxonomy"===n&&o?React.createElement(Mr,e):t&&"post-excerpt"===t.value?React.createElement(Cr,e):t&&["post-date","post-date-gmt","post-date-modified","post-date-modified-gmt"].includes(t.value)?React.createElement(Hr,e):null})),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xr(e,t)}(t,e),r=t,(n=[{key:"render",value:function(){var e=this.getFieldOption();return e?React.createElement(U.PanelBody,{title:Object(i.__)("Field Options","wpv-views"),initialOpen:!0},e):""}}])&&Qr(r.prototype,n),o&&Qr(r,o),t}(x.Component),tn=Object(M.pure)(en,"FieldOptions");r.d(t,"assureString",(function(){return je})),r.d(t,"withPostPreview",(function(){return Be})),r.d(t,"fetchDynamicContent",(function(){return y})),r.d(t,"fetchCache",(function(){return m})),r.d(t,"searchPost",(function(){return v})),r.d(t,"loadSourceFromCustomPost",(function(){return h})),r.d(t,"SaveWrapper",(function(){return Je})),r.d(t,"EditWrapper",(function(){return dt})),r.d(t,"EditOverlay",(function(){return gt})),r.d(t,"DynamicSource",(function(){return xt})),r.d(t,"DynamicSourceUnified",(function(){return zt})),r.d(t,"withToolsetDynamicField",(function(){return pr})),r.d(t,"getShortcodeOrStatic",(function(){return mr})),r.d(t,"FieldOptions",(function(){return tn})),r.d(t,"TEXT_CATEGORY",(function(){return"text"})),r.d(t,"NUMBER_CATEGORY",(function(){return"number"})),r.d(t,"IMAGE_CATEGORY",(function(){return"image"})),r.d(t,"DATE_CATEGORY",(function(){return"date"})),r.d(t,"AUDIO_CATEGORY",(function(){return"audio"})),r.d(t,"VIDEO_CATEGORY",(function(){return"video"})),r.d(t,"URL_CATEGORY",(function(){return"url"})),r.d(t,"HTML_CATEGORY",(function(){return"html"})),r.d(t,"CUSTOM_POST_UNIQUE_SLUG",(function(){return"__custom_post"}));var rn=window.WPViews;S(),Object(n.registerStore)(R.dynamicSourcesStore,I),rn&&(new se,new Se)}]);